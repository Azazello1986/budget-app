<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>Budget App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/styles.css" rel="stylesheet" />
  </head>
  <body>
    <header class="toolbar">
      <div class="brand">üí∞ Budget App</div>
      <nav class="toolbar-actions">
        <button id="btnHealth" title="–ü—Ä–æ–≤–µ—Ä–∫–∞ API">API: health</button>
        <span id="userEmail" class="muted"></span>
        <a href="/login.html" id="linkLogin">–í–æ–π—Ç–∏</a>
        <a href="/register.html" id="linkRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        <button id="btnLogout" class="hidden" title="–í—ã–π—Ç–∏">–í—ã–π—Ç–∏</button>
      </nav>
    </header>

    <main id="app" class="grid hidden">
      <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –±—é–¥–∂–µ—Ç–∞ -->
      <section class="card">
        <h2>–ë—é–¥–∂–µ—Ç</h2>
        <div class="row">
          <label>–¢–µ–∫—É—â–∏–π –±—é–¥–∂–µ—Ç</label>
          <select id="budgetSelect"></select>
          <button id="btnReloadEverything">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>

        <details>
          <summary>–°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç</summary>
          <div class="row">
            <input id="budgetName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="–ú–æ–π –±—é–¥–∂–µ—Ç" />
            <input id="budgetCurrency" placeholder="–í–∞–ª—é—Ç–∞" value="EUR" />
            <input id="budgetOwnerId" type="number" placeholder="owner_user_id" value="1" />
            <button id="btnCreateBudget">–°–æ–∑–¥–∞—Ç—å</button>
          </div>
        </details>
      </section>

      <!-- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ -->
      <section class="card">
        <h2>–°—á–µ—Ç–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="row">
          <label>–°—á–µ—Ç–∞ (—Ç–µ–∫—É—â–µ–≥–æ –±—é–¥–∂–µ—Ç–∞)</label>
          <ul id="accountsList"></ul>
        </div>
        <div class="row">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–µ–∫—É—â–µ–≥–æ –±—é–¥–∂–µ—Ç–∞)</label>
          <ul id="categoriesList"></ul>
        </div>

        <details>
          <summary>–î–æ–±–∞–≤–∏—Ç—å —Å—á—ë—Ç</summary>
          <div class="row">
            <input id="accName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á—ë—Ç–∞" value="–ö–æ—à–µ–ª–µ–∫" />
            <input id="accCurrency" placeholder="–í–∞–ª—é—Ç–∞" value="EUR" />
            <button id="btnAddAccount">–î–æ–±–∞–≤–∏—Ç—å —Å—á—ë—Ç</button>
          </div>
        </details>

        <details>
          <summary>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</summary>
          <div class="row">
            <input id="catName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" value="–†–∞–∑–Ω–æ–µ" />
            <button id="btnAddCategory">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
          </div>
        </details>
      </section>

      <!-- –®–∞–≥–∏ –±—é–¥–∂–µ—Ç–∞ -->
      <section class="card">
        <h2>–®–∞–≥–∏ (–º–µ—Å—è—Ü—ã)</h2>
        <div class="row">
          <label>–®–∞–≥</label>
          <select id="stepSelect"></select>
          <button id="btnRefreshStep">–û–±–Ω–æ–≤–∏—Ç—å —à–∞–≥</button>
        </div>

        <details open>
          <summary>–°–æ–∑–¥–∞—Ç—å —à–∞–≥ –∑–∞ –º–µ—Å—è—Ü</summary>
          <div class="row">
            <input id="stepName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
            <input id="stepStart" type="date" />
            <input id="stepEnd" type="date" />
            <button id="btnCreateStep">–°–æ–∑–¥–∞—Ç—å</button>
          </div>
        </details>

        <details>
          <summary>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –¥—Ä—É–≥–æ–π —à–∞–≥</summary>
          <div class="row">
            <select id="copyToStep"></select>
            <button id="btnCopyPlanned">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </details>
      </section>

      <!-- –û–ø–µ—Ä–∞—Ü–∏–∏ -->
      <section class="card">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
        <div class="row">
          <label>–¢–∏–ø</label>
          <select id="opKind">
            <option value="planned">–ü–ª–∞–Ω</option>
            <option value="actual" selected>–§–∞–∫—Ç</option>
          </select>

          <label>–ó–Ω–∞–∫</label>
          <select id="opSign">
            <option value="expense" selected>–†–∞—Å—Ö–æ–¥</option>
            <option value="income">–î–æ—Ö–æ–¥</option>
            <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
          </select>
        </div>

        <div class="row">
          <input id="opAmount" type="number" step="0.01" placeholder="–°—É–º–º–∞" />
          <input id="opCurrency" placeholder="–í–∞–ª—é—Ç–∞" value="EUR" />
        </div>

        <div class="row">
          <label>–°–æ —Å—á—ë—Ç–∞</label>
          <select id="opAcc"></select>

          <label id="accToLabel" class="hidden">–ù–∞ —Å—á—ë—Ç</label>
          <select id="opAccTo" class="hidden"></select>
        </div>

        <div class="row" id="catRow">
          <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <select id="opCat"></select>
        </div>

        <div class="row">
          <input id="opComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" />
        </div>

        <div class="row">
          <button id="btnAddOperation">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </section>

      <!-- –°–≤–æ–¥–∫–∞ –∏ –ª–µ–Ω—Ç–∞ -->
      <section class="card">
        <h2>–°–≤–æ–¥–∫–∞ —à–∞–≥–∞</h2>
        <pre id="summaryBox">‚Äì</pre>
        <h2>–õ–µ–Ω—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <ul id="feedList" class="feed"></ul>
      </section>
    </main>
    <!-- –ü–ª–∞—à–∫–∞ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
    <section id="notAuthed" class="card hidden" style="max-width: 760px; margin: 2rem auto;">
      <h2>–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥</h2>
      <p>–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ <a href="/login.html">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏ <a href="/register.html">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>.</p>
    </section>

    <footer class="footer">
      <span id="status">–ì–æ—Ç–æ–≤–æ</span>
    </footer>

    <script>
      // –ë–∞–∑–æ–≤—ã–π URL API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞
      window.API_BASE = '/api';

      // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      (function () {
        try {
          const token = localStorage.getItem('auth_token'); // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
          const email = localStorage.getItem('auth_email') || '';
          const app = document.getElementById('app');
          const notAuthed = document.getElementById('notAuthed');
          const userEmail = document.getElementById('userEmail');
          const linkLogin = document.getElementById('linkLogin');
          const linkRegister = document.getElementById('linkRegister');
          const btnLogout = document.getElementById('btnLogout');

          if (token) {
            app?.classList.remove('hidden');
            notAuthed?.classList.add('hidden');
            if (userEmail) userEmail.textContent = email ? `‚Ä¢ ${email}` : '';
            linkLogin?.classList.add('hidden');
            linkRegister?.classList.add('hidden');
            btnLogout?.classList.remove('hidden');
            btnLogout?.addEventListener('click', () => {
              localStorage.removeItem('auth_token');
              localStorage.removeItem('auth_email');
              location.href = '/login.html';
            });
          } else {
            app?.classList.add('hidden');
            notAuthed?.classList.remove('hidden');
            linkLogin?.classList.remove('hidden');
            linkRegister?.classList.remove('hidden');
            btnLogout?.classList.add('hidden');
            if (userEmail) userEmail.textContent = '';
          }
        } catch (e) {
          console.warn('Auth UI init error:', e);
        }
      })();
    </script>
    <script src="/app.js"></script>
  </body>
</html>